!function(e){var n={};function t(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(a,i,function(n){return e[n]}.bind(null,i));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=2)}([,,function(e,n,t){e.exports=t(3)},function(e,n){var t={};!function(e){"use strict";t={stripe:null,paymentFormsList:{},finalData:{},zeroDecimals:{},globalStyle:{},init:function(n){this.globalStyle={base:{color:"#32325d",lineHeight:"18px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},n&&(this.globalStyle=n),this.paymentFormsList=e(".enupal-stripe-form-elements"),this.zeroDecimals=["MGA","BIF","CLP","PYG","DJF","RWF","GNF","UGX","JPY","VND","VUV","XAF","KMF","KRW","XOF","XPF"],this.paymentFormsList.each((function(){var n=e(this);t.initializeForm(n),e(this).keydown((function(e){if(13===e.keyCode)return e.preventDefault(),!1}))}))},initializeForm:function(n){if(void 0===e(n).find('[name="enupalStripe[stripeData]"]').val())return!1;var t=e.parseJSON(e(n).find('[name="enupalStripe[stripeData]"]').val()),a=this;navigator.userAgent.indexOf("Firefox")<0&&e(n).find('[name="enupalStripe[stripeData]"]').val(""),this.finalData.finalAmount=t.stripe.amount;var i=Stripe(t.pbk),r=i.elements({locale:t.stripe.locale}),o=e(n).find('[name="paymentType"]'),l=t.paymentTypeIds;if(l.length>1){var s=n.find(".cc-wrapper"),d=n.find(".ideal-wrapper"),u=n.find(".sofort-wrapper");e("#paymentMethod-"+t.paymentFormId).change((function(){var e=this.value;1==e?(o.val(e),s.removeClass("enupal-hidden"),d.addClass("enupal-hidden"),u.addClass("enupal-hidden")):2==e?(d.removeClass("enupal-hidden"),s.addClass("enupal-hidden"),u.addClass("enupal-hidden"),o.val(e)):3==e&&(u.removeClass("enupal-hidden"),d.addClass("enupal-hidden"),s.addClass("enupal-hidden"),o.val(e))}))}if(t.enableShippingAddress&&t.enableBillingAddress){var p=n.find(".shippingAddressContainer");e("#enupalStripe-sameAddressToggle-"+t.paymentFormId).change((function(){this.checked?p.addClass("enupal-hidden"):p.removeClass("enupal-hidden")}))}if(t.coupon.enabled){var m=e("#check-coupon-button-"+t.paymentFormId);this.updateTotalAmoutLabel(n,t);var c=n.find("#remove-coupon-"+t.paymentFormId);this.updatesTotalLabelOnChoosesPlan(n,t),c.click((function(e){e.preventDefault(),a.handleRemoveCoupon(n,t,a)})),m.click((function(e){e.preventDefault(),a.handleCouponValidation(n,t,a)}))}for(var f=0,v=l.length;f<v;f++)1==l[f]?(0==f&&(n.find(".cc-wrapper").removeClass("enupal-hidden"),o.val(l[f])),this.createCardElement(i,t,r,n)):2==l[f]?(0==f&&(n.find(".ideal-wrapper").removeClass("enupal-hidden"),o.val(l[f])),this.createIdealElement(i,t,n,r)):3==l[f]&&(0==f&&(n.find(".ideal-wrapper").removeClass("enupal-hidden"),n.find(".cc-wrapper").removeClass("enupal-hidden"),o.val(l[f])),this.createSofortElement(i,t,n,r))},updateTotalAmoutLabel:function(e,n){var t=e.find("#total-amount-value-"+n.paymentFormId),a=this.getFinalAmount(e,n);t&&t.text(a)},handleRemoveCoupon:function(e,n,t){var a=e.find("#coupon-message-"+n.paymentFormId),i=e.find("#remove-coupon-"+n.paymentFormId),r=e.find("#couponCode-"+n.paymentFormId);r&&r.val(""),a&&a.text(""),i.addClass("enupal-hidden"),e.find('[name="enupalCouponCode"]').val(""),t.updateTotalAmoutLabel(e,n)},handleCouponValidation:function(n,t,a){var i=n.find("#check-coupon-button-"+t.paymentFormId),r=n.find("#coupon-message-"+t.paymentFormId),o=n.find("#remove-coupon-"+t.paymentFormId),l=n.find("#total-amount-value-"+t.paymentFormId),s=n.find("#couponCode-"+t.paymentFormId),d=s.val(),u=t.stripe;s.val("");var p=this.convertToCents(a.getFinalAmount(n,t),u.currency);i.prop("disabled",!0);var m={action:"enupal-stripe/coupons/validate",amount:p,couponCode:d,isRecurring:this.getIsRecurring(n,t),currency:u.currency,successMessage:t.coupon.successMessage};e.ajax({type:"POST",url:"enupal/validate-coupon",data:m,dataType:"json",success:function(e){!0===e.success?(r.removeClass("coupon-error"),r.text(e.successMessage),o.removeClass("enupal-hidden"),l&&l.text(e.finalAmount),n.find('[name="enupalCouponCode"]').val(e.coupon.id)):(r.addClass("coupon-error"),o.addClass("enupal-hidden"),r.text(t.coupon.errorMessage)),i.prop("disabled",!1)}.bind(this),error:function(e,n,t){i.prop("disabled",!1),console.error(e,n,t.toString())}.bind(this)})},createCardElement:function(n,t,a,i){var r="stripe-payments-submit-button-"+t.paymentFormId,o=a.create("card",{hidePostalCode:!0,style:this.globalStyle});o.mount("#card-element-"+t.paymentFormId),o.addEventListener("change",(function(e){var n=document.getElementById("card-errors-"+t.paymentFormId);e.error?n.textContent=e.error.message:n.textContent=""}));i[0];var l=this;i.find("#"+r).on("click",(function(a){if(1!=e(i).find('[name="paymentType"]').val())return!0;var s=i[0];t.enableBillingAddress&&t.enableBillingAddress&&("on"==e(i).find('[name="enupalStripe[sameAddressToggle]"]').val()&&(e(i).find('[name="address[name]"]').removeAttr("required"),e(i).find('[name="address[line1]"]').removeAttr("required"),e(i).find('[name="address[city]"]').removeAttr("required"),e(i).find('[name="address[state]"]').removeAttr("required"),e(i).find('[name="address[zip]"]').removeAttr("required"),e(i).find('[name="address[country]"]').removeAttr("required")));if(s.checkValidity()){a.preventDefault();var d={};l.showProcessingText(i,t),t.enableBillingAddress&&(d={name:e(i).find('[name="billingAddress[name]"]').val(),address_line1:e(i).find('[name="billingAddress[line1]"]').val(),address_city:e(i).find('[name="billingAddress[city]"]').val(),address_state:e(i).find('[name="billingAddress[state]"]').val(),address_zip:e(i).find('[name="billingAddress[zip]"]').val(),address_country:e(i).find('[name="billingAddress[country]"]').val()}),n.createToken(o,d).then((function(e){e.error?document.getElementById("card-errors-"+t.paymentFormId).textContent=e.error.message:l.submitForm(t,i,r,e.token)}))}else{/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&e("#"+s.id+' :input:visible[required="required"]').each((function(){if(!this.validity.valid)return e(this).focus(),e(this).attr("placeholder",this.validationMessage).addClass("placeholderError"),e(this).val(""),!1})),s.reportValidity&&s.reportValidity()}}))},showProcessingText:function(e,n){var t="stripe-payments-submit-button-"+n.paymentFormId;e.find("#"+t).prop("disabled",!0),e.find("#"+t).find("span").length?e.find("#"+t).find("span").text(n.paymentButtonProcessingText):e.find("#"+t).text(n.paymentButtonProcessingText)},submitForm:function(n,t,a,i){var r=e.extend(!0,{},n),o=r.stripe;o.amount=this.convertToCents(this.getFinalAmount(t,r),o.currency),t.find('[name="enupalStripe[amount]"]').val(o.amount),t.find('[name="enupalStripe[testMode]"]').val(r.testMode),i&&t.find('[name="enupalStripe[token]"]').val(i.id),t.unbind("submit",[t,n]),t.submit()},createIdealElement:function(n,t,a,i){var r=this,o=a[0],l="stripe-payments-submit-button-"+t.paymentFormId,s=i.create("idealBank",{style:this.globalStyle});s.mount("#ideal-bank-element-"+t.paymentFormId),s.on("change",(function(e){var n=e.value;a.find('[name="idealBank"]').val(n)})),o.addEventListener("submit",(function(n){if(2!=e(a).find('[name="paymentType"]').val())return!0;n.preventDefault(),r.showProcessingText(a,t),r.submitForm(t,a,l,null)}))},createSofortElement:function(n,t,a,i){var r=this,o=a[0],l="stripe-payments-submit-button-"+t.paymentFormId;o.addEventListener("submit",(function(n){if(3!=e(a).find('[name="paymentType"]').val())return!0;n.preventDefault(),r.showProcessingText(a,t),r.submitForm(t,a,l,null)}))},getIsRecurring:function(e,n){var t=!1;return 1==n.amountType&&(t=e.find('[name="enupalStripe[recurringToggle]"]').is(":checked")),n.enableSubscriptions&&(t=!0),t},getFinalAmount:function(e,n){var t=n.stripe.amount,a=0,i=!1;if(n.enableSubscriptions){var r=null;if(0==n.subscriptionType)n.singleSetupFee>0&&(a=n.singleSetupFee),n.enableCustomPlanAmount&&"undefined"!==(r=e.find('[name="enupalStripe[customPlanAmount]"]').val())&&r>0&&(t=r);else{var o=null;if(r=null,(o="radio"==n.subscriptionStyle?e.find('input[name="enupalStripe[enupalMultiPlan]"]:checked').val():e.find('[name="enupalStripe[enupalMultiPlan]"]').val())in n.multiplePlansAmounts&&(r=n.multiplePlansAmounts[o].amount,n.stripe.currency=n.multiplePlansAmounts[o].currency),o in n.setupFees){var l=n.setupFees[o];l>0&&(a=l)}"undefined"!==r&&r>0&&(t=r)}}else if(1==n.amountType){var s=e.find('[name="enupalStripe[customAmount]"]').val();i=e.find('[name="enupalStripe[recurringToggle]"]').is(":checked"),"undefined"!==s&&s>0&&(t=s)}if((n.applyTax||i)&&n.enableTaxes){var d=parseFloat(n.tax/100*(parseFloat(t)+parseFloat(a))).toFixed(2);t=parseFloat(t)+parseFloat(d);var u=n.taxLabel+": "+n.currencySymbol+d;e.find('[name="enupalStripe[taxAmount]"]').val(d),e.find('[name="tax-amount-label"]').empty().append(u)}return parseFloat(t)+parseFloat(a)},updatesTotalLabelOnChoosesPlan:function(n,t){var a=this;if(0!==t.subscriptionType)if("radio"==t.subscriptionStyle){var i=n.find('input[name="enupalStripe[enupalMultiPlan]"]');e(i).change((function(){e(this).is(":checked")&&a.handleRemoveCoupon(n,t,a)}))}else{var r=n.find('[name="enupalStripe[enupalMultiPlan]"]');e(r).on("change",(function(){a.handleRemoveCoupon(n,t,a)}))}},convertToCents:function(e,n){return this.hasZeroDecimals(n)?e:(100*e).toFixed(0)},convertFromCents:function(e,n){return this.hasZeroDecimals(n)?e:e/100},hasZeroDecimals:function(e){for(var n=0;n<this.zeroDecimals.length;n++)if(this.zeroDecimals[n]===e.toUpperCase())return!0;return!1}},e(document).ready((function(e){var n=null;"undefined"!=typeof enupalStyleOverrides&&(n=enupalStyleOverrides),t.init(n)}))}(jQuery)}]);